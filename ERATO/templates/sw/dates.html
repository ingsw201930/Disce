<!DOCTYPE html>

<!-- <div id=openModal class="ui modal"> -->
<!--     <div> -->
<!--         <a href="#close" title="close" class="close">X</a> -->
<!--         <h2>Modal Box</h2> -->
<!--         <p> modal de ejemplooo </p> -->
<!--     </div> -->
<!-- </div> -->

<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.css">
  <link rel="stylesheet" type="text/css" href="/assets/styles/general.css">
  <link rel="stylesheet" type="text/css" href="/assets/styles/dates/dates.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.7.8/semantic.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.7.8/semantic.min.js"></script>

  <meta charset="UTF-8">
  <title>ERATO</title>
  <script src="/assets/scripts/dates/date_state.js"></script>
  <script src="/assets/scripts/dates/pagination.js"></script>
  <script src="/assets/scripts/dates/dates.js"></script>
</head>

<body id="body" onload="get_date_list(0)">
  {% include '../general/nav.html' %}
  {% include '../general/subbar.html' %}
  <div class="menu_services" >
  	{% include '../general/menu_s.html' %}
    <script>
    document.getElementById("item_md").setAttribute("class", "active item");
    </script>
  </div>

<div class="container">
<div class="main_container"">
      <div class="ui attached tabular menu">
        <a class="item" data-tab="current_date">Current date</a>
        <a class="item active" data-tab="pending_dates">Pending dates</a>
        <a class="item" data-tab="non_rated_dates">Non rated</a>
        <a class="item" data-tab="all_dates">History</a>
      </div>
        <div class="ui bottom attached tab" data-tab="current_date">
          <div class="margined_content">
            {% for current_date in current_dates %}
            <div class="ui card" style="width: 100%">
              <div class="content">
                <div class="header">A date with {{current_date.client.user.username}}</div>
              </div>
              <div class="content">
                <h4 class="ui sub header">
                  Start time: {{current_date.start_time}}
                  <br>
                  End time: {{current_date.end_time}}
                  <br>
                  Price: {{current_date.price}}
                </h4>
                <div class="ui small feed">
                  <div class="event">
                    <div class="content">
                      <div class="summary">
                        Currently you're in a date. Click the button below for confirm ending.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <button class="ui button fluid" onclick="window.location.replace('{{BASEURL}}/end_date/{{date.id}}')">Confirm date ending</button>
            </div>
            {% endfor %}
          </div>
        </div>
      <div class="ui bottom attached tab" data-tab="pending_dates">
        <div class="margined_content">

          {% for date in requested_dates %}
            <div class="ui card" style="width: 100%">
            <div class="content">


            <div class="header">A date with {{date.client.user.username}}</div>

            </div>
            <div class="content">
            <h4 class="ui sub header">
              Start time: {{date.start_time}}
              <br>
              End time: {{date.end_time}}
              <br>
              Price: {{date.price}}
            </h4>
            <div class="ui small feed">
            <div class="event">
            <div class="content">
              <div class="summary">
                  {{date.client.user.username}} Has requested a date.
              </div>
            </div>
            </div>
            </div>
            </div>

            <div class="ui buttons">
                <button id="muestre-#mdata-{{date.client.user_id}}" class="ui left attached button green" onclick="show_modal_data({{date.id}},'{{BASEURL}}')" > Info </button>
            </div>

            <script>
                function show() {
                    <!-- $('.ui.modal').modal('show'); -->
                    $('#mdata-{{date.client.user_id}}').modal('show');
                }
                document.getElementById("muestre-#mdata-{{date.client.user_id}}").addEventListener("click", show);
            </script>

            <div class="ui modal {{date.client.user_username}}" id="mdata-{{date.client.user_id}}" >
                  <i class="close icon"></i>
                  <div class="header">
                    Date information
                  </div>
                  <div class="image content">
                    <div class="ui medium image">
                        <img src={{date.client.profile_picture}}>
                    </div>
                    <div class="description">
                        <div class="ui header"> Client's information </div>
                        <h4 class="ui sub header">
                            Username : {{date.client.user.username}}
                            <br>
                            Description : {{date.client.about}}
                            <br>
                            Start time: {{date.start_time}}
                            <br>
                            End time: {{date.end_time}}
                            <br>
                            Price: {{date.price}}
                        </h4>

                    </div>
                  </div>
                    <div class="ui buttons">
                        <button id="accept-{{date.id}}" class="ui left attached button green" style="width: 45%;" onclick="accept({{date.id}},'{{BASEURL}}')" > Accept</button>
                        <button id="reject-{{date.id}}" class="right attached ui button red" style="width: 45%;" onclick="reject({{date.id}},'{{BASEURL}}')" > Reject </button>
                    </div>
                </div>

            </div>
        {% endfor %}
        </div>
      </div>
      <div class="ui bottom attached tab" data-tab="non_rated_dates">
        <div id="date_list_non_rated">
        </div>
      </div>

      <div class="ui bottom attached tab" data-tab="all_dates">
        <div class="margined_content">
          {% for date in all_dates %}
            <div class="ui card" style="width: 100%">
            <div class="content">
            <div class="header">A date with {{date.client.user.username}}</div>
            </div>
            <div class="content">
            <h4 class="ui sub header">
              Start time: {{date.start_time}}
              <br>
              End time: {{date.end_time}}
              <br>
              Price: {{date.price}}
            </h4>
            <div class="ui small feed">
            <div class="event">
            <div class="content">
              <div class="summary">
                  {{date.client.user.username}} Has requested a date.
              </div>
            </div>
            </div>
            </div>
            </div>
            </div>
        {% endfor %}
        </div>
      </div>


    </div>

</div>
{% include '../general/footer.html' %}
<script type="text/javascript">

var date_id = 0;

function get_date_list(index){
  $.ajax({url: "{{BASEURL}}/s/get_date_list/"+index,
  success: function(result){
      container=document.getElementById("date_list_non_rated")
      container.innerHTML = result;

      $('.ui.rating').rating({
          initialRating: 0,
          maxRating: 5,
          onRate: function (rating) {
          rate(rating);
          }
      });


  }});
}

function rate(rate){
  $.ajax({url: "{{BASEURL}}/rate_date/"+date_id+"/"+rate,
  success: function(result){
      if(result.state=="failed"){
          return;
      }
      $('body').toast({
      class: 'success',
      message: "Your date was rated"});
  }});
}

function set_starts_id(id){
  rate()
  date_id = id;
}

</script>
</body>
</html>

